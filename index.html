<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<style>
  body {
    display: flex;
    flex-direction: column;
    justify-content: top;
    align-items: center;
    min-height: 200vh;
    background: linear-gradient(to right, #74ebd5, #acb6e5);
    font-family: Arial, sans-serif;
    margin: 0;
  }
  h1 { 
    font-size: 5rem; 
    margin: 10px; 
  }
  p {
    font-weight: bolder;
    font-size: 35px;
    color: red;
  }
  #score {
    font-size: 2rem;
    font-weight: bolder;
    padding: 20px;
  }
  #multiplier {
    font-size: 1.3rem;
    color: red;
    font-weight: normal;
  }

  #MoreUpgradesButton{
    position: absolute;
    top: 10px;
    left: 10px;
    color: green;
    background-color: white;
  }

  .raindrop {
    position: absolute;
    width: 5px;
    height: 10px;
    background: blue;
    border-radius: 50%;
  }



  @keyframes fall {
    from { transform: translateY(-50px); opacity: 1; }
    to { transform: translateY(500px); opacity: 0; }
  }
  
  @keyframes fadeOut {
  from { opacity: 1; }
  to { opacity: 0; }
  }
  @keyframes fadeIn {
  from { opacity: 0; }
  to { opacity: 1; }
  }

  .fade {
    animation: fadeOut 1s forwards; /* 1 second fade */
  }

  .fadein {
    animation: fadeIn 1s forwards; /* 1 second fade in */
  }



  @keyframes popEffect {
  0% { transform: scale(1); color: red; font-size: 2.5rem; font-weight: bold;}
  50% { transform: scale(12); color: gold; text-shadow: 0 0 15px gold; font-size: 3rem; font-weight: bolder;}
  100% { transform: scale(1); color: red; text-shadow: none; font-size: 2rem; font-weight: normal;}
}

@keyframes discountPopup {
  0%   { transform: scale(0); opacity: 1; color: gold; font-size: 2rem; font-weight: bold; }
  50%  { transform: scale(4); opacity: 1; color: red; text-shadow: 0 0 20px gold; font-size: 4rem; font-weight: bolder; }
  100% { transform: scale(0); opacity: 0; color: gold; text-shadow: none; font-size: 1rem; font-weight: normal; }
}

.discount-popup {
  position: fixed;
  top: 50%;
  left: 50%;
  transform: translate(-50%, -50%);
  animation: discountPopup 0.85s ease-out forwards;
  pointer-events: none;
  z-index: 9999;
}


.animate-multi {
  animation: popEffect 1s ease;
}

  #cps { 
    font-size: 1.5rem; 
    margin: 10px; 
    font-weight: bold; 
    color: green;

  }
  button {            
    padding: 10px 20px;
    font-size: 1rem;
    border: none;
    border-radius: 10px;
    background: #ff6f61;
    color: white;
    cursor: pointer;
    margin: 5px;
    transition: transform 0.1s ease, background 0.2s;
  }
  button:hover { background: #ff4b3e; }
  button:active { transform: scale(0.9); }
  .shop { margin-top: 10px; display: flex; flex-direction: column; align-items: center; }
  canvas { position: absolute; top: 0; left: 0; z-index: -1; }
</style>
</head>
<body>

<h1>Shape Clicker</h1>
<div id="score"> Score: 0</div> 
<div id="multiplier">×1</div>

<button onclick="addPoint()">Click Me!</button>
<!-- <a href="https://ayzombie.github.io/LAG-MACHINE/" target="_blank">
  <button>click me for 69 quintillion score!</button>
</a> -->
<div id="cps">CPS: 0</div>

<div class="shop">
  <h2>Shop</h2>
  <button id="upgradeBtn" onclick="buyUpgrade()">Upgrade Click (+1) — Cost: 10</button>
  <button id="autoClickerBtn" onclick="buyAutoClicker()">Upgrade Speed — Cost: 50</button>
  <button id="ballSpawnerBtn" onclick="buyBallSpawner()">Add Ball — Cost: 100</button>
  <button id="squareSpawnerBtn" onclick="buySquareSpawner()">Add Square — Cost: 200</button>
  <button id="triangleSpawnerBtn" onclick="buyTriangleSpawner()">Add Triangle — Cost: 500</button>
  <button id="incomeBtn" onclick="buyIncome()">Increase Value — Cost: 1000</button>
  <button id="rebirth" onclick="rebirth()">REBIRTH — COST: 1000000</button>
  <button onclick="restartGame()">Restart Game</button>

</div>

<div id="sidebar">
  <label for="num">Enter a Number for Gifts!</label>
  <input type="number" id="num" placeholder="Type a number">
  <button id="submit">Submit</button>
</div>
<canvas id="gameCanvas"></canvas>

<p id="pathLabel"> PATHS: </p>

<button id="waterPathBtn" onclick="waterPath()">Water Path</button>

<button id="MoreUpgradesButton" onclick="showButtons()">More Upgrades</button>
<button id="rain" onclick="buyRain()">Rain - Cost: 1000000</button>
<button id="snakeBtn" onclick="buySnake()">Snake — Cost: 4000000</button>
<button id="sharkSpawnerBtn" onclick="buySharkSpawner()">Add Shark — Cost: 15000000</button>

<script>  //start of javascript variables!!!!!!!  
if ('scrollRestoration' in history) {   // to go to top when start
  history.scrollRestoration = 'manual';
}

window.onload = function() {
  window.scrollTo(0, 0);
};

let pickedWater = false;

let score = 0;
// CPS tracking (declare once)
let cps = 0;
let cpsHistory = [];
let pointsThisInterval = 0; 
// get the CPS element (your HTML uses id="cps")
const cpsEl = document.getElementById("cps");

let pointsPerClick = 1;
let upgradeCost = 10;

let autoClickerLevel = 1;
let autoClickerCost = 50;

let ballSpawnerCount = 0;
let ballSpawnerCost = 100;
let squareValue = 2;

let squareSpawnerCount = 0;
let squareSpawnerCost = 200;

let triangleSpawnerCount = 0;
let triangleSpawnerCost = 500;
let triangleValue = 5;

let incomeCost = 1000;
let income = 1;

let sharkSpawnerCount = 0;
let sharkSpawnerCost = 15000000; // adjust price
let sharkValue = 100;        // points per bounce

let balls = [];
let squares = [];
let triangles = [];
let popups = [];
let raindrops = [];
let sharks = [];


let rebirthCost = 100000;
let growingCostMulti = 1.5;
let multi = 1;

let pickedPath = false;

let unlockedMoreUpgrades = false;
let rainSpeed = 200;
let boughtRain = false;
let rainInterval = null;

let snake = null;
let boughtSnake = false;
let snakeSpawnerCost = 4000000;

let prestigeLevel = 0;        // how many times prestiged
let prestigePoints = 0;       // total prestige points earned
let prestigeBonus = 1;        // multiplier to everything from prestige
let prestigeCost = 1e8;       // base cost to prestige (100 million, adjust as needed)

document.getElementById("pathLabel").style.display = "none";  //PATHS: label
document.getElementById("waterPathBtn").style.display = "none";

document.getElementById("rain").style.display = "none";
document.getElementById("snakeBtn").style.display = "none";
document.getElementById("MoreUpgradesButton").style.display = "none";
document.getElementById("sharkSpawnerBtn").style.display = "none";

const input = document.getElementById("num");
const button = document.getElementById("submit");
const output = document.getElementById("output");
button.addEventListener("click", () => {                                                                             //cheat codes!!!!
  let value = Number(input.value);
  if (value === 696969) {
    score += 5000000000;
    updateScore();
  }
  input.value = "";
});

const canvas = document.getElementById("gameCanvas");
const ctx = canvas.getContext("2d");

let mouse = { x: canvas.width / 2, y: canvas.height / 2 };
window.addEventListener("mousemove", e => {
  mouse.x = e.clientX;
  mouse.y = e.clientY;
});

//cps
  setInterval(() => {
    cpsHistory.push(pointsThisInterval);
    if (cpsHistory.length > 5) cpsHistory.shift(); // keep last 5 seconds
    cps = pointsThisInterval * 2;
    document.getElementById("cps").innerText = "CPS: " + cps;
    pointsThisInterval = 0;
  }, 500);

function resizeCanvas() {
  canvas.width = window.innerWidth;
  canvas.height = document.body.scrollHeight; // instead of window.innerHeight
}
window.addEventListener("resize", resizeCanvas);
resizeCanvas();

//popup thing
class Popup {
  constructor(x, y, value) {
    this.x = x;
    this.y = y;
    this.value = value;
    this.alpha = 1;
    this.dy = -1.5; // moves up
    this.fontSize = 20; // start font size
  }

  update() {
    this.y += this.dy;
    this.alpha -= 0.02; // fade out
    this.fontSize += 0.3; // optional: grow effect
  }

  draw() {
    ctx.globalAlpha = this.alpha;
    ctx.fillStyle = "red";
    ctx.font = `${this.fontSize}px Arial`;
    ctx.fillText("+" + Math.floor(this.value), this.x, this.y);
    ctx.globalAlpha = 1;
  }
}
// ----- BALL -----
class Ball {
  constructor(
    x = Math.random() * (canvas.width - 30) + 15,
    y = Math.random() * (canvas.height - 30) + 15,
    dx = null, dy = null) {
    this.x = x;
    this.y = y;
    this.dx = dx !== null ? dx : (Math.random() * 2 - 1) * autoClickerLevel;
    this.dy = dy !== null ? dy : (Math.random() * 2 - 1) * autoClickerLevel;
    this.radius = 15;
  }

  update() {
    this.x += this.dx;
    this.y += this.dy;

    if (this.x <= 0 || this.x >= canvas.width) {
      this.dx *= -1;
      let gained = income * multi;
      score += gained;
      pointsThisInterval += gained;
      popups.push(new Popup(this.x, this.y, gained));
      updateScore();
    }
    if (this.y <= 0 || this.y >= canvas.height) {
      this.dy *= -1;
      let gained = income * multi;
      score += gained;
      pointsThisInterval += gained;
      popups.push(new Popup(this.x, this.y, gained));
      updateScore();
    }
  }

  draw() {
    ctx.beginPath();
    ctx.arc(this.x, this.y, this.radius, 0, Math.PI * 2);
    ctx.fillStyle = "#ff6f61";
    ctx.fill();
    ctx.closePath();
  }
}
// ----- SQUARE -----
class Square {
  constructor(
    x = Math.random() * (canvas.width - 30) + 15,
    y = Math.random() * (canvas.height - 30) + 15,
    dx = null, dy = null) {
    this.x = x;
    this.y = y;
    this.dx = dx !== null ? dx : (Math.random() * 2 - 1) * autoClickerLevel * 1.5;
    this.dy = dy !== null ? dy : (Math.random() * 2 - 1) * autoClickerLevel * 1.5;
    this.size = 25;
  }

  update() {
    this.x += this.dx;
    this.y += this.dy;

    if (this.x <= 0 || this.x + this.size >= canvas.width) {
      this.dx *= -1;
      let gained = squareValue * multi;
      score += gained;
      pointsThisInterval += gained;
      popups.push(new Popup(this.x, this.y, gained));
      updateScore();
    }
    if (this.y <= 0 || this.y + this.size >= canvas.height) {
      this.dy *= -1;
      let gained = squareValue * multi;
      score += gained;
      pointsThisInterval += gained;
      popups.push(new Popup(this.x, this.y, gained));
      updateScore();
    }
  }

  draw() {
    ctx.fillStyle = "#61a0ff";
    ctx.fillRect(this.x, this.y, this.size, this.size);
  }
}
// ----- TRIANGLE -----
class Triangle {
  constructor(
    x = Math.random() * (canvas.width - 30) + 15,
    y = Math.random() * (canvas.height - 30) + 15,
    dx = null, dy = null) {

    this.x = x;
    this.y = y;
    this.dx = dx !== null ? dx : (Math.random() * 2 - 1) * autoClickerLevel * 2;
    this.dy = dy !== null ? dy : (Math.random() * 2 - 1) * autoClickerLevel * 2;
    this.size = 30; // side length
  }

  update() {
    this.x += this.dx;
    this.y += this.dy;

    if (this.x <= 0 || this.x + this.size >= canvas.width) {
      this.dx *= -1;
      let gained = triangleValue * multi;
      score += gained;
      pointsThisInterval += gained;
      popups.push(new Popup(this.x, this.y, gained));
      updateScore();
    }
    if (this.y <= 0 || this.y + this.size >= canvas.height) {
      this.dy *= -1;
      let gained = triangleValue * multi;
      score += gained;
      pointsThisInterval += gained;
      popups.push(new Popup(this.x, this.y, gained));
      updateScore();
    }
  }

  draw() {
    ctx.fillStyle = "#ffa500";
    ctx.beginPath();
    ctx.moveTo(this.x, this.y);                        // top point
    ctx.lineTo(this.x - this.size / 2, this.y + this.size);
    ctx.lineTo(this.x + this.size / 2, this.y + this.size);
    ctx.closePath();
    ctx.fill();
  }
}
//. ------ RAINDROP THING -------
class Raindrop {
  constructor() {
    this.x = Math.random() * canvas.width;
    this.y = 0; // start at top
    this.width = 5;
    this.height = 10;
    this.speed = Math.random() * 3 + 2; // 2-5 px per frame
  }

  update() {
    this.y += this.speed;

    // If raindrop hits the bottom
    if (this.y + this.height >= canvas.height) {
      const gained = 1 * multi;  // 1 point per drop, scaled by multiplier
      score += gained;
      pointsThisInterval += gained;
      popups.push(new Popup(this.x, this.y, gained));
      updateScore();
      return false; // signal to remove this raindrop
    }
    return true; // keep raindrop in array
  }

  draw() {
    ctx.fillStyle = "blue";
    ctx.fillRect(this.x, this.y, this.width, this.height);
  }
}

class Snake {
  constructor() {
    this.segments = [];
    this.segmentSize = 14;
    this.length = 20;
    this.x = canvas.width / 2;
    this.y = canvas.height / 2;
    this.speed = 3;

    // initialize body
    for (let i = 0; i < this.length; i++) {
      this.segments.push({ x: this.x - i * this.segmentSize, y: this.y });
    }
  }

  update() {
    // move toward mouse
    let dx = mouse.x - this.x;
    let dy = mouse.y - this.y;
    let dist = Math.sqrt(dx * dx + dy * dy);

    if (dist > 1) {
      this.x += (dx / dist) * this.speed;
      this.y += (dy / dist) * this.speed;
    }

    // body follows
    this.segments.unshift({ x: this.x, y: this.y });
    while (this.segments.length > this.length) {
      this.segments.pop();
    }

    // check collisions with shapes
    this.checkCollisions();
  }

  checkCollisions() {
    const eatRange = this.segmentSize;

    function overlaps(a, b, size) {
      return (
        a.x < b.x + size &&
        a.x + size > b.x &&
        a.y < b.y + size &&
        a.y + size > b.y
      );
    }

    // eat balls
    balls = balls.filter(b => {
      if (overlaps({x:this.x,y:this.y}, {x:b.x-b.radius,y:b.y-b.radius}, b.radius*2)) {
        this.discountPrices();
        return false; // remove ball
      }
      return true;
    });

    // eat squares
    squares = squares.filter(s => {
      if (overlaps({x:this.x,y:this.y}, {x:s.x,y:s.y}, s.size)) {
        this.discountPrices();
        return false;
      }
      return true;
    });

    // eat triangles (approx bounding box)
    triangles = triangles.filter(t => {
      if (overlaps({x:this.x,y:this.y}, {x:t.x-t.size/2,y:t.y}, t.size)) {
        this.discountPrices();
        return false;
      }
      return true;
    });
  }

  discountPrices() {
    upgradeCost = Math.round(Math.max(1, upgradeCost * 0.995));
    autoClickerCost = Math.round(Math.max(1, autoClickerCost * 0.995));
    ballSpawnerCost = Math.round(Math.max(1, ballSpawnerCost * 0.995));
    squareSpawnerCost = Math.round(Math.max(1, squareSpawnerCost * 0.995));
    triangleSpawnerCost = Math.round(Math.max(1, triangleSpawnerCost * 0.995));
    incomeCost = Math.round(Math.max(1, incomeCost * 0.995));
    rebirthCost = Math.round(Math.max(1, rebirthCost * 0.995));
    updateShop();

    const popup = document.createElement("div");
    popup.textContent = "-0.5%";
    popup.className = "discount-popup";
    document.body.appendChild(popup);
    setTimeout(() => popup.remove(), 1000);
  }

  draw(ctx) {
    ctx.save(); // save canvas state

    // Blue gradient body
    const gradient = ctx.createLinearGradient(0, 0, canvas.width, canvas.height);
    gradient.addColorStop(0, "#1E90FF"); // light blue
    gradient.addColorStop(1, "#104E8B"); // deep blue
    ctx.fillStyle = gradient;

    for (let i = 0; i < this.segments.length; i++) {
      const { x, y } = this.segments[i];  // ✅ fixed

      // Wave motion for serpentine look
      const wave = Math.sin((Date.now() / 200) + i * 0.5) * 5;

      if (i === 0) {
        // Head
        ctx.fillStyle = "#104E8B"; // darker head
        ctx.beginPath();
        ctx.arc(x + wave, y, this.segmentSize * 1.2, 0, Math.PI * 2);
        ctx.fill();

        // Eyes
        ctx.fillStyle = "white";
        ctx.beginPath();
        ctx.arc(x - 4, y - 4, 2, 0, Math.PI * 2);
        ctx.arc(x + 4, y - 4, 2, 0, Math.PI * 2);
        ctx.fill();

        ctx.fillStyle = gradient; // reset for body
      } else {
        // Body ovals
        ctx.beginPath();
        ctx.ellipse(
          x + wave,
          y,
          this.segmentSize,
          this.segmentSize * 0.7,
          0,
          0,
          Math.PI * 2
        );
        ctx.fill();
      }
    }

    ctx.restore(); // restore canvas state
  }
}
// ----- SHARK -----
class Shark {
  constructor(
    x = canvas.width / 2 + (Math.random() * 100),
    y = canvas.height / 2 + (Math.random() * 100),
    dx = null, dy = null) {

    this.x = x;
    this.y = y;
    this.dx = dx !== null ? dx : (Math.random() * 2 - 1) * autoClickerLevel;
    this.dy = dy !== null ? dy : (Math.random() * 2 - 1) * autoClickerLevel * 1.5;
    this.size = 80; // overall shark size
  }

  update() {  
    this.x += this.dx;
    this.y += this.dy;

    // bounce and gain points
    if (this.x <= 0 || this.x + this.size >= canvas.width) {
      this.dx *= -1;
      let gained = Math.round(sharkValue) * multi;
      score += gained;
      pointsThisInterval += gained;
      popups.push(new Popup(this.x, this.y, gained));
      sharkValue += 0.01;
      updateScore();
    }

    if (this.y <= 0 || this.y + this.size >= canvas.height) {
      this.dy *= -1;
      let gained = Math.round(sharkValue) * multi;
      score += gained;
      pointsThisInterval += gained;
      popups.push(new Popup(this.x, this.y, gained));
      sharkValue += 0.01;
      updateScore();
    }
  }

  draw() {
    ctx.save();
    ctx.translate(this.x, this.y);

    // Body
    ctx.fillStyle = "blue";
    ctx.beginPath();
    ctx.moveTo(0, 0);                   
    ctx.lineTo(this.size * 0.8, this.size * 0.3);  
    ctx.lineTo(this.size, this.size * 0.5);        
    ctx.lineTo(this.size * 0.8, this.size * 0.7);  
    ctx.lineTo(0, this.size * 0.5);      
    ctx.closePath();
    ctx.fill();

    // Eye
    ctx.fillStyle = "white";
    ctx.beginPath();
    ctx.arc(this.size * 0.2, this.size * 0.35, 3, 0, Math.PI * 2);
    ctx.fill();

    ctx.fillStyle = "black";
    ctx.beginPath();
    ctx.arc(this.size * 0.2, this.size * 0.35, 1.5, 0, Math.PI * 2);
    ctx.fill();

    ctx.restore();
  }

}


                                        // Click + upgrades            //ENDD OF  CLASSES!!!!!
function addPoint() {
  
  let points = pointsPerClick * multi;
  score += points;
  pointsThisInterval += points;

  // Push numeric popup (don't overwrite .value with a string — see note below)
  const popup = new Popup(mouse.x, mouse.y, points);

  updateScore();
}

function buyUpgrade() {                   //UPGRADE CLICK
  if (score >= upgradeCost) {
    score -= upgradeCost;
    pointsPerClick++;
    upgradeCost = Math.floor(upgradeCost * 1.3);
    updateShop();
    updateScore();
  }
}

function buyAutoClicker() {             //upgrade speed!
  if (score >= autoClickerCost) {
    score -= autoClickerCost;
    autoClickerLevel++;
    autoClickerCost = Math.floor(autoClickerCost * 1.35);
    balls.forEach(b => { b.dx *= 1.2; b.dy *= 1.2; });
    squares.forEach(s => { s.dx *= 1.2; s.dy *= 1.2; });
    updateShop();
    updateScore();
  }
}

function buyBallSpawner() {                 //more balls!
  if (score >= ballSpawnerCost) {
    score -= ballSpawnerCost;
    ballSpawnerCount++;
    ballSpawnerCost = Math.floor(ballSpawnerCost * 1.2);
    balls.push(new Ball());
    updateShop();
    updateScore();
  }
}

function buySquareSpawner() {               //MORE SQUARES
  if (score >= squareSpawnerCost) {
    score -= squareSpawnerCost;
    squareSpawnerCount++;
    squareSpawnerCost = Math.floor(squareSpawnerCost * 1.3);
    squares.push(new Square());
    updateShop();
    updateScore();
  }
}

function buyTriangleSpawner() {           //MORE TRIANGLES
  if (score >= triangleSpawnerCost) {
    score -= triangleSpawnerCost;
    triangleSpawnerCount++;
    triangleSpawnerCost = Math.floor(triangleSpawnerCost * 1.4);
    triangles.push(new Triangle());
    updateShop();
    updateScore();
  }
}

function buyIncome() {           //mORE VALUE LETS GO BABY!
  if (score >= incomeCost) {
    score -= incomeCost;
    income++;
    squareValue += 2;
    triangleValue += 5;
    incomeCost = Math.floor(incomeCost * 1.7);
    updateShop();
    updateScore();
  }
}

//                          UPDATES AND ANIMATION
function animate() {                  //ANIMATION!
  ctx.clearRect(0, 0, canvas.width, canvas.height);

  balls.forEach(ball => { 
    ball.update(); 
    ball.draw(); 
  });

  squares.forEach(square => { 
    square.update(); 
    square.draw(); 
  });

  triangles.forEach(triangle => {
    triangle.update();
    triangle.draw();
  });

  popups.forEach((p, index) => {
  p.update();
  p.draw();
  if (p.alpha <= 0) popups.splice(index, 1);
  });
  
  raindrops = raindrops.filter(drop => {
    const alive = drop.update();
    drop.draw();
    return alive;
  });


  if (snake) {
  snake.update();
  snake.draw(ctx);
  }

  sharks.forEach(s => {
  s.update();
  s.draw();
  });

  requestAnimationFrame(animate);
}

function updateShop() {           //UPDATE THE SHOP
  document.getElementById("upgradeBtn").innerText = "Upgrade Click (+" + pointsPerClick + ") — Cost: " + upgradeCost;
  document.getElementById("autoClickerBtn").innerText = "Upgrade Speed (Lv " + autoClickerLevel + ") — Cost: " + autoClickerCost;
  document.getElementById("ballSpawnerBtn").innerText = "Add Ball (Now " + ballSpawnerCount + ") — Cost: " + ballSpawnerCost;
  document.getElementById("squareSpawnerBtn").innerText = "Add Square (Now " + squareSpawnerCount + ") — Cost: " + squareSpawnerCost;
  document.getElementById("incomeBtn").innerText = "Increase Value (Now " + income + ") — Cost: " + incomeCost;
  document.getElementById("triangleSpawnerBtn").innerText = "Add Triangle (Now " + triangleSpawnerCount + ") — Cost: " + triangleSpawnerCost;
  document.getElementById("sharkSpawnerBtn").innerText = "Add Shark (Now " + sharkSpawnerCount + ") — Cost: " + sharkSpawnerCost;
  document.getElementById("rebirth").innerText = "REBIRTH (Multi:  " + multi + ") — Cost: " + rebirthCost;

} 

function updateScore() {
  // Check for insane numbers and restart
  if (score > 1e200) {
    restartGame();
  }

  // Unlock more upgrades if score is high enough
  if (score >= 5000000 && !unlockedMoreUpgrades) {
    unlockedMoreUpgrades = true;
    document.getElementById("MoreUpgradesButton").style.display = "block";
  }

  // Update UI
  document.getElementById("score").innerText = "Score: " + Math.floor(score);
  document.getElementById("multiplier").innerText = "×" + multi;

  // Save automatically
  saveGame();
}


// ----------------- Save / Load -----------------
function saveGame() {
  const saveData = {
    score, pointsPerClick, upgradeCost,
    autoClickerLevel, autoClickerCost,
    ballSpawnerCount, ballSpawnerCost,
    squareSpawnerCount, squareSpawnerCost,
    triangleSpawnerCount, triangleSpawnerCost,
    income, incomeCost,
    squareValue, triangleValue,
    balls: balls.map(b => ({x: b.x, y: b.y, dx: b.dx, dy: b.dy})),
    squares: squares.map(s => ({x: s.x, y: s.y, dx: s.dx, dy: s.dy})),
    triangles: triangles.map(t => ({x: t.x, y: t.y, dx: t.dx, dy: t.dy})),
    sharks: sharks.map(t => ({x: t.x, y: t.y, dx: t.dx, dy: t.dy})),
    multi, rebirthCost, growingCostMulti,
    unlockedMoreUpgrades,
    rainSpeed, boughtRain,
    boughtSnake, snake,
    pickedWater,
    sharkSpawnerCost, sharkSpawnerCount, sharkValue
    
  };
  localStorage.setItem("clickerSave", JSON.stringify(saveData));
}

function loadGame() {
  const saved = JSON.parse(localStorage.getItem("clickerSave"));
  if (saved) {
    score = saved.score || 0;
    pointsPerClick = saved.pointsPerClick || 1;
    upgradeCost = saved.upgradeCost || 10;
    autoClickerLevel = saved.autoClickerLevel || 1;
    autoClickerCost = saved.autoClickerCost || 50;

    ballSpawnerCount = saved.ballSpawnerCount || 0;
    ballSpawnerCost = saved.ballSpawnerCost || 100;

    squareSpawnerCount = saved.squareSpawnerCount || 0;
    squareSpawnerCost = saved.squareSpawnerCost || 200;

    triangleSpawnerCount = saved.triangleSpawnerCount || 0;
    triangleSpawnerCost = saved.triangleSpawnerCost || 500;

    income = saved.ballValue || 1;
    squareValue = saved.squareValue || 2;
    triangleValue = saved.triangleValue || 5;
    incomeCost = saved.incomeCost || 1000;

    multi = saved.multi || 1;
    rebirthCost = saved.rebirthCost || 100000;
    growingCostMulti = saved.growingCostMulti || 1.5;

    unlockedMoreUpgrades = saved.unlockedMoreUpgrades || false;
    raindrops = saved.raindrops || [];
    rainSpeed = saved.rainSpeed || 200;
    boughtRain = saved.boughtRain || false;

    pickedWater = saved.pickedWater || false;

    boughtSnake = saved.boughtSnake || false;
    if (boughtSnake) snake = new Snake();

    //hide buttons
    if (boughtRain == true) {
      document.getElementById("rain").style.display = "none";
      startRain();
    }
    if (unlockedMoreUpgrades == true) {
      document.getElementById("MoreUpgradesButton").style.display = "block";
      if (pickedPath == true) {
        if (pickedWater == false) {
          document.getElementById("pathLabel").style.display = "block";  //PATHS: label
          document.getElementById("waterPathBtn").style.display = "block";
        }
      }
      // if (pickedWater == true) {
      //   document.getElementById("rain").style.display = "block";
      //   document.getElementById("snakeBtn").style.display = "block";
      //   document.getElementById("MoreUpgradesButton").style.display = "block";
      //   document.getElementById("sharkSpawnerBtn").style.display = "block";
        
      // }
    }


    // Restore balls/squares/triangles (optional)
    balls = (saved.balls || []).map(b => new Ball(b.x, b.y, b.dx, b.dy));
    squares = (saved.squares || []).map(s => new Square(s.x, s.y, s.dx, s.dy));
    triangles = (saved.triangles || []).map(t => new Triangle(t.x, t.y, t.dx, t.dy));
  } else {
    // If no save, initialize default objects
    balls = [];
    for (let i = 0; i < ballSpawnerCount; i++) balls.push(new Ball());
    squares = [];
    triangles = [];
    raindrops = [];
    sharks = [];
  }
  restorePaths();
  startRain();
  updateShop();
  updateScore();
}

function restartGame() {
  if (rainInterval) {
    clearInterval(rainInterval); // stop the rain
    rainInterval = null;         // reset so it can start again later
  }

  if ('scrollRestoration' in history) {   // to go to top when start
  history.scrollRestoration = 'manual';
  }

  window.onload = function() {
    window.scrollTo(0, 0);
  };

  pickedWater = false;

  multi = 1;
  score = 0;
  pointsPerClick = 1;
  upgradeCost = 10;
  autoClickerLevel = 1;
  autoClickerCost = 50;

  ballSpawnerCount = 0;
  ballSpawnerCost = 100;

  squareSpawnerCount = 0;
  squareSpawnerCost = 200;

  triangleSpawnerCount = 0;
  triangleSpawnerCost = 500;

  income = 1;
  squareValue = 2;
  triangleValue = 5;
  incomeCost  = 1000;

  balls = [];
  squares = [];
  triangles = [];
  raindrops = [];
  sharks = [];

  growingCostMulti = 1.5;
  rebirthCost = 100000;
  unlockedMoreUpgrades = false;
  rainSpeed = 200;
  boughtRain = false;
  
  sharkSpawnerCount = 0;
  sharkSpawnerCost = 15000000;
  sharkValue = 10;    

  removeSnake(); //sets all snake variables to false and deletes snake

  //HIDE THE UPGRADES
  document.getElementById("rain").style.display = "none";
  document.getElementById("MoreUpgradesButton").style.display = "none";
  document.getElementById("pathLabel").style.display = "none";
  document.getElementById("snakeBtn").style.display = "none";
  document.getElementById("sharkSpawnerBtn").style.display = "none";
  document.getElementById("waterPathBtn").style.display = "none";

  updateShop();
  updateScore();
  saveGame();
}

//                                  CUSTOM STUFF!

function restorePaths() {
  if (pickedWater == true) {
    document.getElementById("waterPathBtn").style.display = "none";
    if (boughtRain == false) {
    document.getElementById("rain").style.display = "block";
    }
    if (boughtSnake == false) {
      document.getElementById("snakeBtn").style.display = "block";
    }
  }
}

function wait(ms) { 
  return new Promise(resolve => setTimeout(resolve, ms));
}

async function rebirth() {
  document.getElementById("rebirth").style.display = "none";
  if (score >= rebirthCost) { // check cost
    multi += 1;
                                  //the ffing andimation lol!dfsd
  const multiEl = document.getElementById("multiplier");
  multiEl.classList.add("animate-multi");
  setTimeout(() => multiEl.classList.remove("animate-multi"), 1005);

  let cur_score = score;
  
  while (score > 0) {
    score -= getRandom(0.001 * cur_score, 0.01 * cur_score);
    updateScore();
    if (score < 0) 
      score = 0;
      updateScore();
      await wait(1);
  }
  score = 0;
  cur_score = 0;
  pointsPerClick = 1;
  upgradeCost = 10;
  autoClickerLevel = 1;
  autoClickerCost = 50;

  ballSpawnerCount = 0;
  ballSpawnerCost = 100;

  squareSpawnerCount = 0;
  squareSpawnerCost = 200;

  triangleSpawnerCount = 0;
  triangleSpawnerCost = 500;

  sharkSpawnerCount = 0;
  sharkSpawnerCost = 15000000;
  sharkValue = 10; 

  ballValue = 1;
  squareValue = 2;
  triangleValue = 5;
  incomeCost = 1000;

  balls = [];
  squares = [];
  triangles = [];
  raindrops = [];
  sharks = [];

  growingCostMulti = 1.5;
  rebirthCost = 100000;
  unlockedMoreUpgrades = false;
  rainSpeed = 200;
  boughtRain = false;

    if (rainInterval) {
      clearInterval(rainInterval); // stop the rain
      rainInterval = null;         // reset
    }
    boughtRain = false;
    unlockedMoreUpgrades = false;
    removeSnake();

    let newRebirthCost = rebirthCost * growingCostMulti;
    if (newRebirthCost < 1000000) {
      growingCostMulti *= 1.5;
    }
    if (newRebirthCost >= 1000000 && newRebirthCost < 10000000) {
      growingCostMulti *= 1.1;
    }
    if (newRebirthCost >= 10000000 && newRebirthCost< 100000000) {
      growingCostMulti *= 1.02;
    }
    else {
      growingCostMulti *= 1.01;
    }
    rebirthCost = Math.floor(newRebirthCost);

    document.getElementById("rain").style.display = "none";
    document.getElementById("MoreUpgradesButton").style.display = "none";
    document.getElementById("pathLabel").style.display = "none";
    document.getElementById("snakeBtn").style.display = "none";
    document.getElementById("sharkSpawnerBtn").style.display = "none";
    document.getElementById("waterPathBtn").style.display = "none";
    document.getElementById("rebirth").style.display = "block";
    updateShop();
    updateScore();
    saveGame();
  }
}

function getRandom(min, max) {       //random number function!!!!
  return Math.floor(Math.random() * (max - min + 1)) + min;
}

function showButtons() {
  document.getElementById("MoreUpgradesButton").style.display = "none";
  document.getElementById("pathLabel").style.display = "block";
  unlockedMoreUpgrades = false;
  if (pickedPath == false) {
    document.getElementById("waterPathBtn").style.display = "block";
  }
}

function waterPath() {
  document.getElementById("pathLabel").style.display = "none"; //hide the path label
  waterPathBtn.classList.add("fade");
  waterPathBtn.style.pointerEvents = "none";
  waterPathBtn.addEventListener("animationend", () => {
  waterPathBtn.style.display = "none";
  waterPathBtn.classList.remove("fade");
  }, { once: true });

  if (boughtRain == false) {
    document.getElementById("rain").style.display = "block";
  }
  if (boughtSnake == false) {
    document.getElementById("snakeBtn").style.display = "block";
  }
  document.getElementById("sharkSpawnerBtn").style.display = "block";
}

function createRaindrop() {
  raindrops.push(new Raindrop());
}

function startRain() {
  if (boughtRain && !rainInterval) { // only start if not already running
    rainInterval = setInterval(createRaindrop, rainSpeed);
  }
}

function buyRain() {
  const rainCost = 1000000;
  const rainBtn = document.getElementById("rain");
  const snakeBtn = document.getElementById("snakeBtn");

  if (score >= rainCost && !boughtRain) {
    score -= rainCost;
    boughtRain = true;
    startRain(); 
    updateScore();

    // fade rain button out
    rainBtn.classList.add("fade");
    rainBtn.style.pointerEvents = "none"; // prevent clicks
    rainBtn.addEventListener("animationend", () => {
      rainBtn.style.display = "none";
      rainBtn.classList.remove("fade");
    }, { once: true });
  }
}

function buySnake() {
  const snakeBtn = document.getElementById("snakeBtn");

  if (score >= snakeSpawnerCost && !boughtSnake) {
    score -= snakeSpawnerCost;
    boughtSnake = true;
    snake = new Snake();
    updateScore();

    // fade out snake button when bought
    snakeBtn.classList.add("fade");
    snakeBtn.style.pointerEvents = "none";
    snakeBtn.addEventListener("animationend", () => {
      snakeBtn.style.display = "none";
      snakeBtn.classList.remove("fade");
    }, { once: true });
  }
}

function removeSnake() {
  if (snake) {
    snake = null;           // stop updating/drawing
    boughtSnake = false;    // allow buying again
    document.getElementById("snakeBtn").style.display = "none"; // hide button
  }
}

function buySharkSpawner() {
  if (score >= sharkSpawnerCost) {
    score -= sharkSpawnerCost;
    sharks.push(new Shark());
    sharkSpawnerCost = Math.floor(sharkSpawnerCost * 1.5);
    sharkSpawnerCount += 1;
    updateShop();
    updateScore();
  }
}



loadGame();                   
animate(); 
</script>
</body>
</html>